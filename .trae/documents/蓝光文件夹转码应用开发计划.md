# 蓝光文件夹转码应用开发计划

## 1. 项目结构调整
- 创建模块化的项目结构，包括：
  - `src/components/` - 组件目录
  - `src/services/` - 服务层（FFmpeg管理、转换逻辑）
  - `src/types/` - 类型定义
  - `src/utils/` - 工具函数
  - `src/views/` - 视图组件

## 2. 核心功能实现

### 2.1 FFmpeg 集成与管理
- **内置FFmpeg**：在应用内部创建 `ffmpeg/` 目录存储FFmpeg可执行文件
- **版本检测**：实现FFmpeg版本检测和完整性验证
- **自动更新**：添加从官方渠道下载并更新FFmpeg的功能
- **跨平台支持**：针对Windows/macOS/Linux分别处理FFmpeg二进制文件

### 2.2 蓝光文件夹处理
- **结构识别**：正确解析蓝光文件夹的BDMV目录结构
- **媒体信息读取**：识别视频流、音轨、字幕轨道、章节信息
- **主文件检测**：自动识别蓝光文件夹中的主播放文件

### 2.3 转换核心逻辑
- **无损封装**：使用FFmpeg的 `-c copy` 参数实现真正的无损转换
- **完整元数据保留**：确保所有音轨、字幕、章节和元数据完整保留
- **命令构建**：动态构建正确的FFmpeg命令行参数

## 3. 用户界面设计

### 3.1 主界面布局
- **源文件夹选择**：直观的文件夹选择界面
- **输出路径设置**：支持自定义输出路径
- **转换选项配置**：提供必要的转换选项
- **批量添加功能**：支持添加多个蓝光文件夹

### 3.2 任务队列管理
- **队列列表**：显示所有待转换和正在转换的任务
- **任务控制**：暂停、继续、取消任务的按钮
- **优先级调整**：支持调整任务顺序

### 3.3 进度和日志
- **实时进度显示**：转换进度条和百分比
- **详细日志输出**：显示FFmpeg的输出日志
- **错误提示**：友好的错误信息展示

## 4. 任务控制功能
- **后台转换**：支持最小化到托盘后台转换
- **任务持久化**：重启应用后恢复未完成的任务
- **系统资源优化**：根据系统负载调整转换优先级

## 5. 质量保证
- **完整性校验**：转换后文件的完整性验证
- **质量对比**：确保音视频质量与原始蓝光一致
- **兼容性测试**：测试生成的MKV文件在主流播放器上的兼容性

## 6. 技术实现细节

### 6.1 Tauri 命令扩展
- 在 `src-tauri/src/lib.rs` 中添加以下命令：
  - `detect_bdmv_structure` - 检测蓝光文件夹结构
  - `get_media_info` - 获取媒体信息
  - `run_ffmpeg` - 运行FFmpeg转换
  - `stop_ffmpeg` - 停止FFmpeg进程
  - `check_ffmpeg_version` - 检查FFmpeg版本
  - `update_ffmpeg` - 更新FFmpeg

### 6.2 前端组件开发
- `FileSelector.vue` - 文件选择组件
- `TaskQueue.vue` - 任务队列组件
- `ProgressBar.vue` - 进度条组件
- `LogViewer.vue` - 日志查看组件
- `FFmpegManager.vue` - FFmpeg管理组件

### 6.3 状态管理
- 使用Vue 3的Composition API和响应式状态管理转换任务
- 实现任务状态的持久化存储

## 7. 测试和优化
- **单元测试**：对核心功能进行单元测试
- **集成测试**：测试完整的转换流程
- **性能优化**：优化转换速度和资源占用
- **兼容性测试**：测试不同操作系统和蓝光文件夹结构

## 8. 开发时间线
- 第1周：项目结构调整和FFmpeg集成
- 第2周：蓝光文件夹处理和转换核心逻辑
- 第3周：用户界面设计和任务队列管理
- 第4周：任务控制功能和质量保证
- 第5周：测试、优化和文档编写

## 9. 预期成果
- 功能完整的蓝光文件夹转码应用
- 支持批量处理和后台转换
- 完整的FFmpeg管理功能
- 友好的用户界面和详细的日志
- 跨平台支持和良好的兼容性

这个计划将确保我们开发出一个高质量、功能完整的蓝光文件夹转码应用，满足用户的所有需求。